app-id: io.wasabiwallet.WasabiWallet
runtime: org.freedesktop.Platform
runtime-version: "20.08"
sdk: org.freedesktop.Sdk
command: start-wasabiwallet.sh
finish-args:
  - --socket=x11
  - --share=ipc
  - --device=dri
  - --socket=pulseaudio
  - --share=network
modules:
  - name: wasabiwallet
    buildsystem: simple
    build-commands:
      # Verify source
      - gpg --import publickey.gpg; gpg --verify wasabi.deb.asc wasabi.deb

      - ar x wasabi.deb
      - tar -xf data.tar.xz

      - for size in 256 512; do [[ -e "usr/share/icons/hicolor/${size}x${size}/apps/wassabee.png" ]] && install
        -Dm644 "usr/share/icons/hicolor/${size}x${size}/apps/wassabee.png" "/app/share/icons/hicolor/${size}x${size}/apps/${FLATPAK_ID}.png";
        done

      - cp -r usr/local/bin/wasabiwallet /app/wasabiwallet
    sources:
      - type: file
        url: https://github.com/zkSNACKs/WalletWasabi/releases/download/v1.1.12.6/Wasabi-1.1.12.6.deb
        dest-filename: wasabi.deb
        sha256: b2be2883e420cc0a3bfb4e1ca55ea77a239b3f2ffa20cf090f2d97307f148fe7
        x-checker-data:
          type: anitya
          project-id: 183074
          url-template: https://github.com/zkSNACKs/WalletWasabi/releases/download/v$version/Wasabi-$version.deb
      - type: file
        url: https://github.com/zkSNACKs/WalletWasabi/releases/download/v1.1.12.6/Wasabi-1.1.12.6.deb.asc
        dest-filename: wasabi.deb.asc
        sha256: 129dd04fc7d7be7a459453bef73c1c634da1d49bceff959bfe163bf29eec5014
        x-checker-data:
          type: anitya
          project-id: 183074
          url-template: https://github.com/zkSNACKs/WalletWasabi/releases/download/v$version/Wasabi-$version.deb.asc
      - type: file
        url: https://github.com/zkSNACKs/WalletWasabi/raw/master/PGP.txt
        dest-filename: publickey.gpg
        sha256: 9441be37097fee21d61d938e17788766f9821e2619b97e03047af9b91ef5fbac
  - name: start-script
    buildsystem: simple
    build-commands:
      - install -Dm755 start-wasabiwallet.sh /app/bin/start-wasabiwallet.sh
    sources:
      - type: script
        dest-filename: start-wasabiwallet.sh
        commands:
          - /app/wasabiwallet/wassabee $@
  - name: desktop-entry
    buildsystem: simple
    build-commands:
      - install -Dm644 io.wasabiwallet.WasabiWallet.desktop /app/share/applications/$FLATPAK_ID.desktop
    sources:
      - type: file
        path: io.wasabiwallet.WasabiWallet.desktop
        sha256: f7b7bb2ac67c5564110c7e2c65291323b9dd96d0b6ff62ebcfc7f51e5d7ae166
  - name: metainfo
    buildsystem: simple
    build-commands:
      - install -Dm644 io.wasabiwallet.WasabiWallet.metainfo.xml /app/share/metainfo/$FLATPAK_ID.metainfo.xml
    sources:
      - type: file
        path: io.wasabiwallet.WasabiWallet.metainfo.xml
